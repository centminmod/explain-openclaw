> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Feb 16 sync 15 (97 commits)

**Merge commit:** b83ccfba1 | **Range:** 53ff9cd42..b83ccfba1

### Security-Relevant Commits

| SHA | Message | Files | Security Impact |
|-----|---------|-------|-----------------|
| `559c8d993` | fix: replace deprecated SHA-1 in sandbox config hash | 1 prod + 1 doc | **Cryptographic Upgrade:** Replaced SHA-1 with SHA-256 in `computeHash()` at config-hash.ts:51-54. SHA-1 is vulnerable to collision attacks (SHAtted, SHAppening); SHA-256 is cryptographically secure. |
| `d1fca442b` | refactor(sandbox): centralize sha256 helpers | 3 prod | **Helper Extraction:** Added `hashTextSha256()` at hash.ts:3 and updated `slugifySessionKey()` at shared.ts:7 to use centralized SHA-256. Related to `559c8d993` hardening. |
| `cbf58d2e1` | fix(memory): harden context window cache collisions | 1 prod + 1 test + 1 doc | **Fail-Safe Token Budgeting:** Added `applyDiscoveredContextWindows()` at context.ts:17-36 that prefers smallest context window when multiple providers expose same model ID with different limits. Prevents token budget overflow from provider metadata conflicts. |
| `b32ae6fa0` | fix (memory/qmd): isolate managed collections per agent | 2 prod + 2 test | **Agent Isolation:** Added `scopeCollectionBase()` at backend-config.ts:98 and `sanitizeCollectionNameSegment()` at qmd-manager.ts:878 to scope QMD collections per-agent (e.g., `sessions-main`, `memory-dir-dev`). Prevents cross-agent memory data leakage in multi-tenant deployments. |
| `41ded303b` | fix(sandbox): preserve array order in config hashing | 1 prod + 1 test + 1 doc | **Config Hash Consistency:** Changed `normalizeForHash()` at config-hash.ts:22-41 to preserve primitive array order instead of sorting. Ensures DNS/capability bind mounts produce deterministic container hashes. |
| `68ea06395` | fix: preserve openai reasoning replay ids | 2 prod + 8 test | **Transcript Policy Change:** Modified `resolveTranscriptPolicy()` at transcript-policy.ts:76 to disable tool-call ID sanitization for OpenAI provider. Not a hardening - relaxes sanitization to fix reasoning replay. Affects transcript hygiene. |
| `6754a926e` | fix(pairing): support legacy telegram allowFrom migration | 3 prod + 2 test | **Backward Compatibility:** Added `dedupePreserveOrder()` at pairing-store.ts:237 and modified `readChannelAllowFromStore()` at pairing-store.ts:314-331 to merge legacy unscoped allowFrom with account-scoped entries. Ensures pairing persists across upgrades. |
| `c7bc7249c` | test (security/line): cover missing webhook auth startup paths | 0 prod + 2 test | **Test Coverage:** Added 4 test cases verifying LINE webhook rejects missing `channelSecret` and `channelAccessToken`. Test-only additions - no production code changes but validate security-critical auth paths. |

### Non-Security Commits

| SHA | Message | Files | Reason |
|-----|---------|-------|--------|
| `39fa81dc9` | chore: bump version to 2026.2.16 | 47 files | Version bump |
| `4f5bc0a49` | chore(release): align 2026.2.15 metadata | 1 production | Metadata alignment |
| `fb6dba205` | fix(ci): align tar override and lockfile to 7.5.9 | 2 files | Dependency sync |
| `61a865031` | fix: sync pnpm lockfile for docker onboard | 1 file | Lockfile sync |
| `c62b90a2b` | fix(telegram): stop block streaming from splitting messages | 1 production + 1 test | UX fix - message streaming |
| `b5a63e18f` | test(sandbox): add array-order hash and recreate regression tests | 2 test | Test-only |
| `c8e110e2e` | refactor(skills): extract installer strategy helpers | 2 production | Refactor - no security logic |
| `189cba010` | test: remove duplicate sandbox access memory-flush case | 1 test | Test-only |
| `93e62d8e3` | test: remove duplicate slack dm authorization case | 1 test | Test-only |
| `aef1d5530` | fix(cron): normalize skill-filter snapshots and split isolated run helpers | 10 production | Refactor - skill filter normalization |

### Line Number Changes

The following files had line number shifts affecting documentation references:

| File | Change | New Location |
|------|--------|--------------|
| `src/agents/sandbox/config-hash.ts` | `computeHash()` moved after helper extraction | Line 51-54 |
| `src/agents/sandbox/config-hash.ts` | `normalizeForHash()` | Line 22-33 |
| `src/memory/backend-config.ts` | `scopeCollectionBase()` added | Line 98-100 |
| `src/memory/qmd-manager.ts` | `sanitizeCollectionNameSegment()` added | Line 878 |
| `src/pairing/pairing-store.ts` | `readChannelAllowFromStore()` expanded | Line 314-331 |
| `src/agents/context.ts` | `applyDiscoveredContextWindows()` added | Line 17-36 |

### Audit Cross-Reference

**Affected Claims:**
- **SHA-1 deprecation:** Addresses cryptographic best practices; SHA-1 collision vulnerabilities known since 2017
- **Context window hardening:** Prevents token budget overflow from provider metadata conflicts
- **QMD isolation:** Enforces agent boundary in memory subsystem; relevant to multi-tenant deployments
- **Config hash consistency:** Ensures Docker container identity determinism for security-sensitive mounts (DNS, capDrop, binds)

**Unaffected Claims:**
- OAuth token storage (Claim 1) - unchanged
- CSRF state validation (Claim 2) - unchanged
- Hardcoded OAuth secret (Claim 3) - unchanged
- Token refresh race condition (Claim 4) - unchanged
- File permission checks (Claim 5) - unchanged
- Path traversal (Claim 6) - unchanged
- Webhook signature (Claim 7) - unchanged (LINE tests validate existing fail-closed behavior)
- Token expiry (Claim 8) - unchanged

**Legitimate Gaps Status:**
- Gap 1 (Gateway env blocklist): CLOSED - unchanged
- Gap 2 (Pipe-delimited token format): OPEN - unchanged
- Gap 3 (outPath validation): OPEN - unchanged
- Gap 4 (Bootstrap/memory .md scanning): OPEN - unchanged

**Gap status: 1 closed, 3 remain open.** â€” see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
