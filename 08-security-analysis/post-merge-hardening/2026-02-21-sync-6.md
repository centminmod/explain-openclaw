# Feb 21 Sync 6 — 9 Commits (2 Security)

**Merge SHA:** `7ac4d2887`
**Range:** `7894277cf..220bd95ef`
**Date:** 2026-02-21

## Security-Relevant Commits

| SHA | Message | Description |
|-----|---------|-------------|
| `220bd95ef` | fix(browser): block non-network navigation schemes | The `assertBrowserNavigationAllowed` function (`src/browser/navigation-guard.ts:27-53`) now blocks non-network URL schemes instead of implicitly allowing them. A new `SAFE_NON_NETWORK_URLS` allowlist (line 8) permits only `about:blank`, while `file://`, `data:`, `javascript:`, and other non-http(s) schemes are rejected with `InvalidBrowserNavigationUrlError` (lines 48-50). This prevents local file read via `file://` URLs and XSS via `javascript:` or `data:` URLs in browser automation contexts. Defense-in-depth for path-based attacks. |
| `c6ee14d60` | fix(security): block grep safe-bin file-read bypass | The `grep` profile in `SAFE_BIN_PROFILES` (`src/infra/exec-safe-bin-policy.ts:93-128`) changed `maxPositional` from `1` to `0` (line 97). This closes a bypass where `-e <pattern>` consumed the positional slot intended for the pattern, freeing it for a filename operand that could read arbitrary files. The pattern must now come exclusively from `-e`/`--regexp` flags, keeping grep stdin-only. |

### Key Code Locations

- `SAFE_NON_NETWORK_URLS` allowlist: `src/browser/navigation-guard.ts:8`
- Protocol rejection logic: `src/browser/navigation-guard.ts:48-50`
- `grep` safe-bin profile: `src/infra/exec-safe-bin-policy.ts:93-128`
- `maxPositional: 0` enforcement: `src/infra/exec-safe-bin-policy.ts:97`

## Audit Cross-Reference

| Commit | Audit Claims Affected |
|--------|----------------------|
| `220bd95ef` | Defense-in-depth for Audit 2 Claim 2 (arbitrary write via paths) — blocks `file://` scheme exploitation |
| `c6ee14d60` | Audit 2 Claim 3 (Log traversal via `logs.tail`) — demonstrates safe-bin hardening against file-read bypass patterns; defense-in-depth for Audit 1 Claim 6 (path traversal) |

## Non-Security Commits

| SHA | Message | Files |
|-----|---------|-------|
| `f81522af2` | fix(docker): install Playwright Chromium into node cache (#22585) | 1 prod + 1 doc |
| `75d4f6d51` | docs: reorder and trim 2026.2.21 changelog entries | 1 doc |
| `eccff0b6c` | docs: relabel dependency hygiene changelog entries | 1 doc |
| `9231d7d30` | chore: bump version to 2026.2.21 | 1 doc + 41 prod (version bumps) |
| `677384c51` | refactor: simplify Telegram preview streaming to single boolean (#22012) | 8 prod + 4 doc + 1 test |
| `e1cb73cde` | fix: unblock Docker build by aligning commands schema default (#22558) | 3 prod + 2 doc |
| `3f1925984` | Update bug_report.yml | 1 prod |

## Summary

Two security hardening commits this sync:

1. **Navigation scheme allowlist enforcement:** Browser navigation now requires `http:` or `https:` protocols, with explicit allowlist for `about:blank` only. Blocks `file://` (local file read), `javascript:` (XSS), `data:` (injection), and other dangerous schemes.

2. **Safe-bin grep positional bypass fix:** The `grep` safe-bin profile changed `maxPositional` from 1 to 0, requiring patterns via `-e`/`--regexp` flags only. Prevents file operand smuggling when pattern flag consumes the positional slot.

---

[Gap Status](../post-merge-hardening.md#legitimate-gaps-status)
