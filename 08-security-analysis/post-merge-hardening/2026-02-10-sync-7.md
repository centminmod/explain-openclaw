> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Post-Merge Hardening (Feb 10 sync 7, 6 upstream commits)

Primarily QMD memory query scoping, legacy config migration for `memorySearch`, and gateway eager-init for QMD backend. One security-relevant fix:

**LOW — Data isolation (1):**

- **`ef4a0e92b`** (PR [#11645](https://github.com/openclaw/openclaw/pull/11645)) — **fix(memory/qmd): scope query to managed collections:** `QmdMemoryManager.query()` now passes `-c <collection>` flags via new `buildCollectionFilterArgs()` (`src/memory/qmd-manager.ts:1080-1086`), restricting QMD searches to explicitly configured collections only. If no managed collections are configured, queries return empty results with a warning log. Defense-in-depth for **Gap #4** (bootstrap/memory `.md` scanning) — ensures QMD queries cannot inadvertently access unmanaged collection data.

**Other notable changes:**

- **`efc79f69a`** — **Gateway: eager-init QMD backend on startup:** New `startGatewayMemoryBackend()` in `src/gateway/server-startup-memory.ts` initializes QMD backend during gateway startup rather than lazily on first query. Improves reliability; non-blocking (failure logged as warning).

- **`868873016` + `a76dea0d2` + `8d80212f9`** — **Config: migrate legacy top-level memorySearch:** Adds migration rule for `memorySearch` → `agents.defaults.memorySearch` in `src/config/legacy.rules.ts:88-92` and `src/config/legacy.migrations.part-3.ts`. Changelog credited.

- **`40919b1fc`** — **fix(test): add StringSelectMenu to @buape/carbon mock:** Non-security test fix.

**Line number shifts in this sync:** `src/memory/qmd-manager.ts` +5 lines at line 265 (collection filter args), +8 lines at end (new `buildCollectionFilterArgs()` method). References updated: `qmd-manager.ts:331-337` → `336-342` (4 files).

**CVE status:** 5 published advisories — all pre-existing, none patched in this merge.

**Gap status: 1 closed, 3 remain open** (pipe-delimited token format, outPath validation — Gap #3 partially mitigated, bootstrap/memory .md scanning — Gap #4 strengthened by collection scoping) — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
