> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Feb 16 sync 9 (21 commits)

**Merge commit:** 6288c5177 | **Range:** a6a5e1ef9..6288c5177

### Summary

This batch contains 1 security-relevant feature commit (cron finished-run webhook, PR #14535) and 20 test infrastructure commits (test suite consolidation and env restore refactors). The webhook feature introduces outbound HTTP notifications with URL validation, bearer token auth, timeout protection, and log redaction.

### Commits

#### Security-Relevant Commits (1)

| SHA | Message | Files | Notes |
|-----|---------|-------|-------|
| 115cfb443 | gateway: add cron finished-run webhook (#14535) | 25 (6 test + 19 production) | New outbound webhook for cron job completion notifications |

**`115cfb443` â€” Cron Finished-Run Webhook (PR #14535):**

Adds an optional webhook notification when cron jobs complete. Security properties:

- **URL validation:** Webhook URLs must be http:// or https:// via `HttpUrlSchema` (`src/config/zod-schema.ts:96-102`)
- **Sensitive token handling:** `webhookToken` field marked with `.register(sensitive)` for automatic credential redaction (`src/config/zod-schema.ts:307`)
- **Bearer token auth:** Webhook token sent as `Authorization: Bearer <token>` header (`src/gateway/server-cron.ts:240`)
- **Opt-in per-job gating:** Webhooks only fire when `job.notify === true` AND the run produced a summary (`src/gateway/server-cron.ts:235`)
- **Timeout protection:** 10-second timeout via `AbortController` prevents indefinite hangs from unresponsive endpoints (`src/gateway/server-cron.ts:28, 242-245`)
- **URL redaction in logs:** `redactWebhookUrl()` strips query parameters and credentials before logging errors (`src/gateway/server-cron.ts:30-37, 257`)
- **Job CRUD preservation:** Notify flag persisted across job creation (`src/cron/service/jobs.ts:259`) and patch operations (`src/cron/service/jobs.ts:288-289`); type definition at `src/cron/types.ts:74`
- **Protocol schema:** Cron protocol updated with notify field (`src/gateway/protocol/schema/cron.ts`)
- **UI integration:** Control UI forwards notify toggle state (`ui/src/ui/controllers/cron.ts`, `ui/src/ui/views/cron.ts`)

#### Non-Security Commits (20)

Test suite consolidation (`perf(test)`) and env restore refactors (`refactor(test)`):

| SHA | Message | Files |
|-----|---------|-------|
| 6288c5177 | perf(test): fold secret equality assertions into audit extra suite | 2 test |
| a508c3473 | perf(test): fold signal daemon log parsing into probe suite | 2 test |
| 5baa08ed1 | perf(test): fold model-default assertions into command utils suite | 2 test |
| 55fd88e96 | perf(test): consolidate utils parsing helpers | 4 test |
| 725f63f72 | perf(test): fold restart recovery helper into spawn utils suite | 2 test |
| c82dc02b4 | perf(test): fold tui command parsing into tui suite | 2 test |
| 2cf060f77 | perf(test): consolidate media-understanding misc suites | 3 test |
| 5529473af | perf(test): fold browser server-context helper into utils suite | 2 test |
| 5e3b211d9 | perf(test): fold gmail watcher assertions into hooks install suite | 2 test |
| 3fd40fc5a | perf(test): fold media constants assertions into mime suite | 2 test |
| f934725cc | perf(test): consolidate channel misc suites | 4 test |
| 5709b3070 | perf(test): consolidate config misc suites | 5 test |
| 2d5004cee | perf(test): consolidate CLI utility tests | 7 test |
| 1287abe0b | perf(test): consolidate browser utility tests | 6 test |
| a91bcd2cf | fix(test): avoid fake-timers hang in gateway lock | 1 test |
| 67bfe8fb8 | perf(test): cut gateway unit suite overhead | 13 (12 test + 1 test-infra: scripts/test-parallel.mjs) |
| be4a490c2 | refactor(test): fix update-cli env restore | 1 test |
| e9ed5febc | refactor(test): dedupe token exchange env cleanup | 1 test |
| 72baa58ed | refactor(test): fix copilot env restore | 1 test |
| 76015aab2 | refactor(test): dedupe copilot env restores | 1 test |

### Audit Cross-Reference

**Audit 1 (Issue #1796):**
- Claim 7 (Webhook signature bypass): The new cron webhook is an outbound notification (gateway posts TO external endpoint), not an inbound webhook receiver. Bearer token auth is used; no signature verification needed for outbound requests. Not affected.
- Claims 1-6, 8: Not affected. No OAuth, CSRF, file permission, path traversal, or token expiry changes.

**Audit 2 (Medium article):**
- Claim 4 (DNS rebinding SSRF): The webhook URL is validated to require http(s):// protocol and the request has a 10-second timeout, but no SSRF-specific DNS rebinding protections (like `resolvePinnedHostname`) are applied to the outbound webhook fetch. This is mitigated by the fact that webhook URLs are admin-configured (not user/agent-supplied). Low risk.
- Claims 1-3, 5-8: Not affected. No setupCommand, outPath, log traversal, RBAC, token format, regex, or env var changes.

**Legitimate Gaps:** None of the 3 gaps are affected or closed by this batch.

### Line Number Changes

None. No doc-referenced source files had line number shifts in this batch. The changed production files (`src/agents/tools/cron-tool.ts`, `src/config/zod-schema.ts`, `src/cron/service/jobs.ts`) are not cited with line numbers in the documentation.

**Gap status:** [see Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
