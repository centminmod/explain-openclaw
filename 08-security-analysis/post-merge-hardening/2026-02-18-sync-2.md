> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Feb 18 Sync 2 (21 commits)

**Merge commit:** ac38d5129 | **Range:** 442587bf0..ac38d5129

### Security-Relevant Commits

| SHA | Message | Files | Security Impact |
|-----|---------|-------|-----------------|
| `901d4cb31` | revert: accidental merge of OC-09 sandbox env sanitization change | 3 prod + 2 test | **REGRESSION** — Removed `sanitizeEnvVars()` and `validateEnvVars()` that blocked credential patterns (ANTHROPIC_API_KEY, OPENAI_API_KEY, OPENCLAW_GATEWAY_TOKEN, AWS credentials) and dangerous env vars (LD_PRELOAD, DYLD variants) from Docker sandbox. Re-opens env var injection vector (Audit 2 Claim 8). |
| `4ca75bed5` | fix(models): sync auth-profiles before availability checks | 2 prod + 3 test + 1 doc | Syncs auth-profiles before model availability checks to handle expired tokens. Touches `pi-auth-json.ts` (auth infrastructure). |
| `2b3ecee7c` | fix(actions): layer per-account gate fallback | 6 prod + 3 test + 1 doc | Adds per-account gate fallback for Discord/Telegram actions. Strengthens approval gate inheritance between account and channel levels. Related to Audit 2 Claim 5 (self-approving agent). |

### Non-Security Commits

| SHA | Message | Files | Reason |
|-----|---------|-------|--------|
| `ac38d5129` | chore: Fix types in tests 7/N. | 5 prod + 4 test | Test type fixes |
| `0aa28c71c` | fix(doctor): move forced exit to top-level command | 3 prod + 2 test | CLI command structure |
| `f79cf3a01` | revert: remove accidentally merged video-quote-finder skill (#18550) | 4 prod | Skill removal |
| `a78839e60` | chore: Fix Slack test. | 0 prod + 1 test | Test fix |
| `bb8df6ab8` | revert(tools): finish rollback of PR #18584 | 0 prod + 1 test | Test revert |
| `f924ab40d` | revert(tools): undo accidental merge of PR #18584 | 5 prod + 2 test | Web tools revert |
| `0158e4129` | Revert "fix: resolve #12770 - update Antigravity default model and trim leading whitespace in BlueBubbles replies" | 3 prod + 1 test | Provider revert |
| `fb6e415d0` | fix(agents): align session lock hold budget with run timeouts | 4 prod + 1 test | Resource management |
| `ce4b4d947` | revert(doctor): undo accidental merge of PR #18591 | 5 prod + 1 doc | Docs revert |
| `414754546` | Revert "feat: show transcript file size in session status" | 3 prod + 1 test | UI revert |
| `9789dfd95` | fix(ui): correct usage range totals and muted styles | 4 prod + 2 test | UI styling |
| `fbda9a93f` | fix(failover): align abort timeout detection and regressions | 1 prod + 4 test | Failover handling |
| `f24224683` | fix(subagents): pass group context in /subagents spawn | 2 prod + 1 test | Context passing |
| `616c0bd4c` | chore: Cleanup unused vars that were leftover from the reverts. | 1 prod | Cleanup |
| `b3d9ecf4e` | chore: Fix types that were broken due to reverts. | 2 prod + 1 test | Type fixes |
| `01ea80887` | chore: Format files. | 17 prod | Formatting |
| `003d6c45d` | chore: Fix types in tests 6/N. | 0 prod + 6 test | Test type fixes |
| `b6d4f7c00` | chore: Fix types in tests 5/N. | 1 prod + 7 test | Test type fixes |

### Audit Cross-Reference

**Affected Claims:**
- **Audit 2 Claim 8 (Env variable injection)** — REGRESSION via `901d4cb31`. The sandbox env sanitization system that blocked LD_PRELOAD/DYLD_* and credential patterns was removed. Sandbox containers now pass all environment variables without filtering.
- **Audit 2 Claim 5 (Self-approving agent)** — Related via `2b3ecee7c`. The per-account gate fallback strengthens approval gate inheritance, but is not a direct fix.

**Unaffected Claims:**
- Audit 1 Claims 1-8 (OAuth, file permissions, path traversal, webhook)
- Audit 2 Claims 1-4, 6-7 (setupCommand, nodes tool, logs.tail, SSRF, token format, shell injection)
- Legitimate Gaps 1-3 (gateway env blocklist remains closed; pipe token format and outPath validation remain open)

### Summary

This batch includes **one security regression** — the removal of sandbox environment variable sanitization that was accidentally merged and then reverted. The removed code blocked credential patterns (ANTHROPIC_API_KEY, OPENAI_API_KEY, OPENCLAW_GATEWAY_TOKEN, AWS credentials) and dangerous loader variables (LD_PRELOAD, DYLD variants) from being passed to Docker containers.

The other 18 commits are predominantly reverts of accidental merges, test type fixes, formatting, and non-security bug fixes. Two additional commits touch security-adjacent areas (auth-profiles sync, actions gate fallback) but do not materially change security posture.

**Gap status: 1 closed, 3 remain open.** — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
