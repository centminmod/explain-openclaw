> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Feb 18 Sync 9 (10 commits, 2 security)

**Merge commit:** d30492823 | **Range:** fbad2ede6..d30492823

### Security-Relevant Commits (2)

| SHA | Message | Files | Audit Impact |
|-----|---------|-------|--------------|
| `b5f551d71` | fix(security): OC-06 prevent path traversal in config includes | 2 prod + 1 test | Audit 1 Claim 6 (defense-in-depth) |
| `d1c00dbb7` | fix: harden include confinement edge cases (#18652) | 3 prod + 2 test | Audit 1 Claim 6 (defense-in-depth) |

### Commit Details

1. **`b5f551d71`** — **NEW** OC-06: CWE-22 path traversal fix in `$include` directive.
   - `src/config/includes.ts:175-207` — `resolvePath()` with path boundary validation using `isPathInside()` helper
   - `src/config/includes.ts:190-204` — symlink resolution prevents symlink bypass attacks
   - `src/config/includes.ts:35-44` — `ConfigIncludeError` thrown for escaping paths
   - **Attack vectors blocked:** absolute paths, relative traversal (`../`), symlink bypass, home directory access
   - Tests: 23 security tests in `src/config/includes.test.ts`

2. **`d1c00dbb7`** — **REINFORCES** OC-06 edge case hardening.
   - `src/security/scan-paths.ts:3-8` — NEW: `isPathInside()` cross-platform path containment check
   - `src/config/includes.ts:76-90` — `IncludeProcessor` with `rootDir`/`rootRealDir` for top-level config confinement
   - `src/commands/doctor-config-flow.ts:150-173` — `noteIncludeConfinementWarning()` surfaces hints for invalid paths
   - `docs/gateway/configuration-reference.md` — clarified `$include` path rules
   - Tests: 4 more tests in `src/config/includes.test.ts`, 1 in `doctor-config-flow.include-warning.test.ts`

### Non-Security Commits (8)

| SHA | Message | Files | Reason |
|-----|---------|-------|--------|
| `edf7d6af6` | fix: harden subagent completion announce retries | 2 prod + 2 doc | Reliability |
| `ae3637b23` | test: expand subagent announce completion coverage | 2 test | Testing |
| `c90b09cb0` | feat(agents): support Anthropic 1M context beta header | 2 prod + 1 test + 2 doc | Feature |
| `40a666159` | test(cli): fix option-collision mock typings | 6 test | Testing |
| `c1928845a` | fix: route native subagent spawns to target session | 1 prod + 1 test | Bugfix |
| `4134875c3` | fix: route discord native subagent announce to channel target | 2 prod + 1 test | Bugfix |
| `34851a78b` | fix: route manual subagent spawn replies via OriginatingTo fallback | 1 prod + 1 test | Bugfix |
| `d30492823` | chore(auto-reply): format subagent command files | 1 prod + 1 test | Chore |

### Audit Cross-Reference

**Affected Claims:**
- **Audit 1 Claim 6** (Path traversal in agent dirs): Defense-in-depth for config file paths. The new `$include` path confinement prevents configuration-based path traversal attacks that could escape the config directory.

**Unaffected Claims:**
- Audit 1 Claims 1-5, 7-8: No OAuth, CSRF, token, or webhook changes
- Audit 2 Claims 1-8: No setupCommand, nodes tool, log traversal, SSRF, RBAC, pipe injection, shell injection, or env injection changes
- Legitimate Gaps: No changes to env blocklist (closed), token format, outPath validation, or bootstrap scanning

### Line Number Updates

Stale references updated in this sync:
- `open-upstream-prs.md:225,489` — `subagent-announce.ts:545-559` → `822-833` (statsLine)
- `2026-02-17-sync-1.md:30` — `subagent-announce.ts:368-370` → `621-623` (SILENT_REPLY_TOKEN)
- `2026-02-16-sync-1.md:17` — `subagent-announce.ts:177-207` → `announce-idempotency.ts:10-12` (idempotency key extraction)

**Gap status: 1 closed, 3 remain open.** — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
