> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Post-Merge Hardening (Feb 15 sync 5) — 30 upstream commits

**Merge commit:** `9236a2745` | **Range:** `f9366bd33..9236a2745`
**Triage:** 14 flagged (after Haiku demotion of 13 `perf(test)` + cosmetic commits), 16 safe. 11 security-relevant, 3 non-security flagged.

---

### Security-Relevant Commits (11)

#### Shell Injection Prevention Chain (3 commits)

1. **`9dce3d8bf`** — **fix(security): prevent shell injection in macOS keychain credential write (#15924):** Changes `writeClaudeCliKeychainCredentials()` in `src/agents/cli-credentials.ts:352-397` from `execSync` (shell string) to `execFileSync` (array arguments) for the macOS `security add-generic-password` call. Prevents `$()` and backtick expansion in OAuth token values that could be injected via the keychain credential write path. **Addresses Audit 2 Claim 7** (shell injection via incomplete regex) — while the original claim targeted `isSafeExecutableValue()`, this is a genuine shell injection vector in a different code path that used string-based shell execution with user-controlled token data.

2. **`66d7178f2`** — **fix(security): eliminate shell from Claude CLI keychain refresh:** Extends the same `execSync` → `execFileSync` pattern to the keychain **read** path (`security find-generic-password`) in `src/agents/cli-credentials.ts:389-393`. Comment at line 410: *"Use execFileSync to avoid shell interpretation of user-controlled token values. This prevents command injection via $() or backtick expansion in OAuth tokens."* Comprehensive test coverage added in `src/agents/cli-credentials.test.ts`.

3. **`b90838824`** — **test(security): remove redundant cli-credentials e2e tests:** Removes the old `cli-credentials.e2e.test.ts` file (renamed to `cli-credentials.test.ts` as part of the shell injection fix chain). Test consolidation for the credential security hardening.

#### Webhook Routing Hardening Chain (3 commits)

4. **`188c4cd07`** — **fix(security): reject ambiguous webhook target matches:** Hardens webhook routing in `extensions/bluebubbles/src/monitor.ts` and `extensions/zalo/src/monitor.ts` to reject incoming webhooks when multiple targets match. Previously, ambiguous matches could route messages to the wrong target. Adds test coverage in `extensions/bluebubbles/src/monitor.test.ts` and `extensions/zalo/src/monitor.webhook.test.ts`. **Related to Audit 1 Claim 7** (webhook security area). CHANGELOG updated.

5. **`61d59a802`** — **fix(googlechat): reject ambiguous webhook routing:** Same ambiguous-target-rejection pattern applied to Google Chat in `extensions/googlechat/src/monitor.ts`. New test file `extensions/googlechat/src/monitor.webhook-routing.test.ts`. CHANGELOG updated.

6. **`d583782ee`** — **fix(security): harden discovery routing and TLS pins (17 files):** Major hardening across mobile and desktop gateway clients. Affects Android (`apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt`, `ConnectionManager.kt`, `ConnectionManagerTest.kt`), iOS (`apps/ios/Sources/Gateway/GatewayConnectionController.swift`, `GatewayServiceResolver.swift`, `GatewayConnectionSecurityTests.swift`), macOS (`apps/macos/Sources/OpenClaw/GatewayDiscoveryHelpers.swift`, `GeneralSettings.swift`, `OnboardingView+Actions.swift`, `GatewayDiscoveryModel.swift`), gateway discover CLI (`src/cli/gateway-cli/discover.ts`, `discover.test.ts`), and documentation (`docs/gateway/bonjour.md`, `bridge-protocol.md`, `discovery.md`). TLS certificate pinning and discovery routing validation prevent man-in-the-middle attacks on gateway connections. CHANGELOG updated.

#### CLI Process Security Chain (2 commits)

7. **`eb60e2e1b`** — **fix(security): harden CLI cleanup kill and matching:** Hardens process signal handling in `src/agents/cli-runner/helpers.ts`. Prevents kill signals from affecting unrelated processes during CLI cleanup. Test coverage in `src/agents/cli-runner.e2e.test.ts`.

8. **`6084d13b9`** — **fix(security): scope CLI cleanup to owned child PIDs:** Further restricts cleanup signals to only processes that were spawned by the current CLI runner instance (`src/agents/cli-runner/helpers.ts`). Prevents PID reuse attacks where a cleanup signal could be sent to a new process that inherited a stale PID. Test coverage in `src/agents/cli-runner.e2e.test.ts`. CHANGELOG updated.

#### Other Security Hardening (3 commits)

9. **`3e0e78f82`** — **fix(nostr): guard profile mutations:** Guards against unauthorized profile mutations in `extensions/nostr/src/nostr-profile-http.ts`. Prevents unauthenticated HTTP requests from modifying Nostr profile configuration. Test coverage in `extensions/nostr/src/nostr-profile-http.test.ts`. **Related to [GHSA-mv9j-6xhh-g383](https://github.com/openclaw/openclaw/security/advisories/GHSA-mv9j-6xhh-g383)** (unauthenticated Nostr profile HTTP endpoints). CHANGELOG updated.

10. **`5b4121d60`** — **fix: harden Feishu media URL fetching (#16285) (thanks @mbelinky):** Hardens URL validation in the Feishu extension for both document and media fetching. `extensions/feishu/src/docx.ts` and `extensions/feishu/src/media.ts` now validate media URLs before fetching to prevent SSRF via crafted document or media references. New test file `extensions/feishu/src/docx.test.ts` and updated `extensions/feishu/src/media.test.ts`. **Related to [GHSA-wfp2-v9c7-fh79](https://github.com/openclaw/openclaw/security/advisories/GHSA-wfp2-v9c7-fh79)** (SSRF via media URL hydration). CHANGELOG updated.

11. **`d3428053d`** — **fix: redact config values in skills status:** Prevents exposure of sensitive configuration values (API keys, tokens) in the skills status output. `src/agents/skills-status.ts` and `src/hooks/hooks-status.ts` now redact sensitive config values before displaying them. Test coverage in `src/gateway/server.skills-status.e2e.test.ts`, `src/shared/requirements.test.ts`, and 2 more files. 7 files changed. Defense-in-depth against information disclosure.

---

### Non-Security Commits (from flagged, 3)

| SHA | Message | Files | Note |
|-----|---------|-------|------|
| `a7142c621` | perf(test): cache hook installer fixtures | 1 | Test performance optimization |
| `9fb48f4df` | refactor(scripts): make run-node main testable | 2 | Test infrastructure |
| `50645b905` | refactor(outbound): centralize outbound identity | 7 | Outbound identity refactoring (promoted by triage, not security-relevant) |

### Safe Commits (16)

| SHA | Message | Files | Category |
|-----|---------|-------|----------|
| `9236a2745` | perf(test): speed up web logout tests | 1 | Test perf (demoted) |
| `fe2d883cf` | perf(test): remove fs skill scanning from skill-commands tests | 1 | Test perf (demoted) |
| `5349a0f7c` | perf(test): mock reserved commands in skill-commands tests | 1 | Test perf (demoted) |
| `8ff278798` | perf(test): speed up skill-commands tests | 1 | Test perf (demoted) |
| `f2c56de95` | perf(test): speed up memory suites | 5 | Test perf (demoted) |
| `ee82c173a` | perf(test): reduce web logout fs churn | 1 | Test perf (demoted) |
| `2b5e0a607` | perf(test): speed up memory batch + web logout | 2 | Test perf (demoted) |
| `ebcc6480c` | perf(cli): split skills formatting | 3 | CLI UX refactor (demoted) |
| `76e4e9d17` | perf(test): reduce skills + update + memory suite overhead | 6 | Test perf (demoted) |
| `684c18458` | perf(test): speed up line, models list, and memory batch | 6 | Test perf (demoted) |
| `ebc68861a` | fix: remove unused imports | 2 | Cleanup (demoted) |
| `1d6abddb9` | fix(signal): outbound formatting and markdown IR rendering | 12 | Formatting (demoted) |
| `9e147f00b` | fix(doctor): resolve telegram allowFrom usernames | 4 | Config doctor fix (demoted) |
| `94ff44f11` | test: make telegram network config hermetic | 1 | Test hermetic (original safe) |
| `226bf7463` | docs(telegram): document allowlist id requirement | 2 | Docs (original safe) |
| `d82c5ea9d` | refactor(utils): share safe json stringify | 3 | Utility refactor (original safe) |

---

### Audit Cross-Reference

| Audit Claim | Commits | Impact |
|-------------|---------|--------|
| **Audit 2 Claim 7** (Shell injection via incomplete regex) | `9dce3d8bf`, `66d7178f2` | Direct fix — eliminates shell execution in keychain credential write/read |
| **Audit 1 Claim 7** (Webhook signature bypass) | `188c4cd07`, `61d59a802` | Related area — webhook routing hardening (ambiguous target rejection) |
| **GHSA-mv9j-6xhh-g383** (Nostr profile tampering) | `3e0e78f82` | Related — guards profile mutations |
| **GHSA-wfp2-v9c7-fh79** (SSRF via media URL) | `5b4121d60` | Related area — hardens Feishu media URL fetching |

### New Advisories in This Sync

Three new GitHub Security Advisories published Feb 14, 2026 (not yet in official-security-advisories.md before this sync):

| ID | Severity | Summary |
|----|----------|---------|
| [GHSA-mv9j-6xhh-g383](https://github.com/openclaw/openclaw/security/advisories/GHSA-mv9j-6xhh-g383) | HIGH | Unauthenticated Nostr profile HTTP endpoints |
| [GHSA-g27f-9qjv-22pm](https://github.com/openclaw/openclaw/security/advisories/GHSA-g27f-9qjv-22pm) | LOW | Log poisoning via WebSocket headers |
| [GHSA-3m3q-x3gj-f79x](https://github.com/openclaw/openclaw/security/advisories/GHSA-3m3q-x3gj-f79x) | MEDIUM | Voice-call webhook verification bypass behind proxy |

### Line Number Verification

No line number shifts in this sync for documented source references:
- `src/agents/cli-credentials.ts:358-362` — verified: `try { existingResult = execFileSyncImpl(` (keychain read)
- `src/agents/cli-credentials.ts:377` — verified: `const newValue = JSON.stringify(existingData)` (keychain write prep)
- `src/cron/isolated-agent/run.ts:327-356` — verified: external hook security wrapping unchanged
- `src/cron/isolated-agent/run.ts:337-344` — verified: suspicious pattern detection unchanged
- `src/cron/isolated-agent/run.ts:350-356` — verified: `buildSafeExternalPrompt()` unchanged

### File Rename

| Old Path | New Path | Commit |
|----------|----------|--------|
| `src/agents/cli-credentials.e2e.test.ts` | `src/agents/cli-credentials.test.ts` | range |

---

**Gap status: 1 closed, 3 remain open** — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
