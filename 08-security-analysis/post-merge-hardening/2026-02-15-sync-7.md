> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Post-Merge Hardening (Feb 15 sync 7) — 30 upstream commits

**Merge commit:** `8719f381d` | **Range:** `0818f8322..8719f381d`

**Security relevance: HIGH** — 8 security-relevant commits: BlueBubbles webhook auth hardening (GHSA-pchc-86f6-8758), safeBins shell expansion blocking, node.invoke exec approvals blocking, session path traversal prevention, Slack DM authorization gating, Discord exec approval targeting, Telnyx webhook centralization, Urbit SSRF request helpers centralization.

### Security-Relevant Commits (8 of 30)

**HIGH (4):**

- **`743f4b284`** — **fix(security): harden BlueBubbles webhook auth behind proxies:** Defense-in-depth for [GHSA-pchc-86f6-8758](../official-security-advisories.md#ghsa-pchc-86f6-8758-bluebubbles-webhook-auth-bypass-via-loopback-proxy-trust). Further hardens BlueBubbles webhook authentication when deployed behind reverse proxies. Complements the loopback auth bypass removal in `f836c385f` (Feb 15 sync 1). Files: `extensions/bluebubbles/src/webhook.ts`, `extensions/bluebubbles/src/webhook.test.ts`. Also adds WhatsApp inbound access control test split (`8719f381d`).

- **`77b89719d`** — **fix(security): block safeBins shell expansion:** New `buildSafeShellCommand()` in `src/infra/exec-approvals-analysis.ts:734` prevents shell expansion (backtick substitution, `$()` expansion) within safeBins tool execution. Imported at `src/agents/bash-tools.exec.ts:18`, called at `:818`. **Addresses Audit 2 Claims 7 (shell injection regex) and 8 (env variable injection)** — closes a vector where shell metacharacters in safeBins arguments could be expanded before execution.

- **`01b3226ec`** — **fix(gateway): block node.invoke exec approvals:** Blocks `system.execApprovals.get` and `system.execApprovals.set` from the `node.invoke` pathway (`src/gateway/server-methods/nodes.ts:587-598`). Returns explicit error: `"node.invoke does not allow system.execApprovals.*; use exec.approvals.node.*"`. **Addresses Audit 2 Claim 5** (self-approving agent) — prevents nodes from manipulating exec approval state through the invoke pathway.

- **`cab0abf52`** — **fix(sessions): resolve transcript paths with explicit agent context (#16288):** Restructures `src/config/sessions/paths.ts` with new path traversal guards: `resolvePathFromAgentSessionsDir()` (lines 75-85), `resolveSiblingAgentSessionsDir()` (lines 87-102), `extractAgentIdFromAbsoluteSessionPath()` (lines 104-113). All session transcript path resolution now requires explicit agent context, preventing cross-agent path traversal. **Addresses Audit 1 Claim 6** (path traversal in agent directories).

**MEDIUM (4):**

- **`f19eabee5`** — **fix(slack): gate DM slash command authorization:** New `normalizeSlackChannelType()` at `src/slack/monitor/slash.ts:341` with authorization checks at lines 347-354. DM slash commands now undergo explicit authorization gating based on channel type. Continues the fail-closed pattern from `fff59da96` (Feb 3 sync 2).

- **`5ba72bd9b`** — **fix: add discord exec approval channel targeting (#16051)** (thanks @leonnardo): Exec approval forwarding in `src/discord/monitor/exec-approvals.ts` now targets the correct channel for approval messages. Scopes remain `["operator.approvals"]` at line 273. Defense-in-depth for Audit 2 Claim 5 (agent self-approval) — ensures approval requests reach the intended operator channel.

- **`f47584fec`** — **refactor(voice-call): centralize Telnyx webhook verification:** Centralizes Telnyx webhook verification into a dedicated `verifyTelnyxWebhook()` function in `extensions/voice-call/src/webhook-security.ts`. Reduces code duplication and makes the verification path easier to audit. **Strengthens Audit 1 Claim 7** (webhook signature bypass) controls.

- **`d0f64c955`** — **refactor(tlon): centralize Urbit request helpers:** Centralizes HTTP request handling for the Tlon Urbit extension. Continues SSRF hardening from `bfa7d21e9` (Feb 15 sync 6) which added `validateUrbitBaseUrl()` and private network blocking. **Relates to Audit 2 Claim 4** (DNS rebinding SSRF).

### Non-Security Commits (22 of 30)

| SHA | Message | Files |
|-----|---------|-------|
| `8719f381d` | test: split WhatsApp inbound access control tests | test split |
| `b1dd23f61` | perf(test): mock config stack in tools invoke http tests | test perf |
| `9a01d2bba` | perf(test): use tiny fixture for browser extension install test | test perf |
| `4d4296cae` | perf(test): speed up gateway tools invoke HTTP tests | test perf |
| `12565661a` | perf(test): simplify update-check mock in update CLI tests | test perf |
| `d5a724fbe` | perf(test): mock chokidar in memory tests | test perf |
| `77e8a8090` | chore: fix lint after compaction handler split | lint fix |
| `a3c695faa` | perf(test): speed up compaction hook wiring tests | test perf |
| `a042b32d2` | fix: Docker installation keeps hanging on MacOS (#12972) | Docker install |
| `a73ccf2b5` | fix: deliver cron output to explicit targets (#16360) (thanks @rubyrunsstuff) | cron delivery |
| `d14be8472` | fix(whatsapp): honor account-level dmPolicy override (#10082) (thanks @mcaxtr) | WhatsApp config |
| `80407cbc6` | fix: recompute all cron next-run times after job update (thanks @echoVic) | cron timing |
| `9409942de` | test(skills): run skills watcher test in unit suite | test suite |
| `0e046f61a` | fix(skills): avoid skills watcher FD exhaustion | FD leak fix |
| `df7464ddf` | fix(bluebubbles): include sender identity in group chat envelopes (#16326) | BB identity |
| `3369ef5ae` | test: add macmini low-cpu test profile | test profile |
| `4133f4bd3` | refactor(tui): clarify searchable select list width layout (#16378) | TUI layout |
| `7d4078c70` | CLI: fix lazy maintenance command registration (#16374) | CLI registration |
| `4b9cb46c6` | refactor(outbound): dedupe poll threading + tighten duration semantics | outbound refactor |
| `885225019` | fix(cli): stop agents command from being unrecognized (#16267) (#16293) | CLI fix |
| `f5a4a202e` | perf(test): speed up discord proxy test | test perf |
| `240cdd374` | perf(test): speed up cron read ops test | test perf |

### Line Number Shifts

| File | Old | New | Symbol |
|------|-----|-----|--------|
| `src/agents/bash-tools.exec.ts` | `:294-295` | `:296-297` | `validateHostEnv` enforcement |
| `src/agents/bash-tools.exec.ts` | `:298` | `:300` | env merge |
| `src/gateway/server-methods.ts` | `:93-163` | `:99-169` | `authorizeGatewayMethod()` |

**Note:** `server-methods.ts` shift is pre-existing from prior syncs (function shifted +6 lines). This sync's commits did not modify `server-methods.ts` directly — the shift was inherited from an earlier merge that was not updated in docs.

### New CVE/GHSA Advisories

Two new advisories discovered during Phase 6c (not from this sync's commits, but newly published):

- **GHSA-fhvm-j76f-qmjv** (HIGH): Telegram webhook auth bypass when webhook secret is missing. Patched >= v2026.2.2. Fix: `ca92597e1`. Credits: @simecek.
- **GHSA-rmxw-jxxx-4cpc** (MEDIUM): Matrix allowlist bypass via displayName ambiguity. Patched >= v2026.2.2. Fix: `8f3bfbd1c`. Credits: @MegaManSec.

Both fixes were merged in earlier syncs (Feb 4 sync 1 area). Advisory entries added to [Official Security Advisories](../official-security-advisories.md).

### Audit Cross-Reference

| Audit | Claim | Commit | Effect |
|-------|-------|--------|--------|
| Audit 1 #6 | Path traversal in agent dirs | `cab0abf52` | Explicit agent context in session path resolution |
| Audit 1 #7 | Webhook signature bypass | `f47584fec` | Centralized Telnyx verification |
| Audit 2 #1 | Config injection RCE | — | No direct change (rawCommand/argv consistency from sync 6 still active) |
| Audit 2 #4 | DNS rebinding SSRF | `d0f64c955` | Centralized Urbit request helpers |
| Audit 2 #5 | Self-approving agent | `01b3226ec`, `5ba72bd9b` | node.invoke exec approvals blocked + channel targeting |
| Audit 2 #7 | Shell injection regex | `77b89719d` | safeBins shell expansion blocked |
| Audit 2 #8 | Env variable injection | `77b89719d` | safeBins arguments no longer shell-expanded |

**Gap status: 1 closed, 3 remain open** (pipe-delimited token format, outPath validation, bootstrap/memory .md scanning) — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
