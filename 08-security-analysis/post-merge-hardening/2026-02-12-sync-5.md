> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Post-Merge Hardening (Feb 12 sync 5, 33 commits)

**Merge commit:** `24224da4c` | **Range:** `dd0a2184c..b094491cf`

**LOW — Session isolation (1):**

1. **`631102e71`** (PR [#4887](https://github.com/openclaw/openclaw/pull/4887)) — **fix(agents): scope process/exec tools to sessionKey for isolation:** `createOpenClawCodingTools()` now prefers `options.sessionKey` as the `scopeKey` for process/exec tool lists, falling back to `agentId` only if no sessionKey is provided (`src/agents/pi-tools.ts:233-236`). This prevents cross-session process visibility and process killing — each agent session gets its own isolated process scope. Defense-in-depth for session isolation.

**LOW — Error resilience (1):**

2. **`b912d3992`** (PR [#13500](https://github.com/openclaw/openclaw/pull/13500)) — **(fix): handle Cloudflare 521 and transient 5xx errors gracefully:** New `isCloudflareOrHtmlErrorPage()` and `isTransientHttpError()` helpers in `src/agents/pi-embedded-helpers/errors.ts`. HTML error pages (5xx + `<!DOCTYPE`) are detected and sanitized to a clean user-facing message instead of leaking raw HTML. Model fallback now triggers on transient 5xx HTML error pages. Agent runner retries transient HTTP errors before failing (`src/auto-reply/reply/agent-runner-execution.ts`). Not a direct security fix, but prevents information leakage from raw HTML error pages.

**LOW — Cron robustness (6):**

3. **`04f695e56`** (PR [#14385](https://github.com/openclaw/openclaw/pull/14385)) — **fix(cron): isolate schedule errors to prevent one bad job from breaking all jobs:** `recomputeNextRuns()` now wraps `computeJobNextRunAtMs()` in try/catch per job. Failed jobs increment `scheduleErrorCount` and auto-disable after 3 consecutive errors. Other jobs continue unaffected.

4. **`ace5e33ce`** (PR [#14233](https://github.com/openclaw/openclaw/pull/14233)) — **fix(cron): re-arm timer when onTimer fires during active job execution:** Timer is now re-armed even when a job is already running, preventing missed scheduled runs.

5. **`39e3d58fe`** (PR [#14068](https://github.com/openclaw/openclaw/pull/14068)) — **fix: prevent cron jobs from skipping execution when nextRunAtMs advances:** New `recomputeNextRunsForMaintenance()` function only computes missing `nextRunAtMs` values, preventing silent advancement past due jobs without execution (see #13992).

6. **`a88ea42ec`** (PR [#13878](https://github.com/openclaw/openclaw/pull/13878)) — **fix(cron): prevent one-shot at jobs from re-firing on restart after skip/error:** One-shot `at` jobs that are skipped or errored now have `nextRunAtMs` cleared, preventing re-execution on service restart.

7. **`b0dfb8395`** (PR [#13983](https://github.com/openclaw/openclaw/pull/13983)) — **fix(cron): use requested agentId for isolated job auth resolution:** `runCronIsolatedAgentTurn()` now uses `normalizedRequested ?? defaultAgentId` regardless of whether an agent config entry exists. Ensures auth-profiles, workspace, and agentDir resolve to correct per-agent paths.

8. **`04e3a66f9`** (PR [#14140](https://github.com/openclaw/openclaw/pull/14140)) — **fix(cron): pass agentId to runHeartbeatOnce for main-session jobs:** Heartbeat runs now receive the correct `agentId` for main-session cron jobs.

**Non-security (18):**

- **`b094491cf`** + **`fa427f63b`** — Config: restore schema.ts helper types after hints refactor.
- **`d8016c30c`** — fix: add types condition to plugin-sdk export for moduleResolution NodeNext.
- **`5c32989f5`** — perf: use JSON.parse instead of JSON5.parse for sessions.json (~35x faster).
- **`4b86c9e55`** + **`bbfaac88f`** — Telegram: surface REACTION_INVALID as non-fatal warning, handle no-text message in model picker.
- **`3696b15ab`** — Slack: change default replyToMode from "off" to "all".
- **`472808a20`** — Tests: update thread ID handling in Slack message collection tests.
- **`7a0591ef8`** + **`186dc0363`** + **`e24d02308`** — WhatsApp: allow media-only sends, default MIME type for voice messages, convert Markdown formatting to WhatsApp formatting. New `src/markdown/whatsapp.ts` module.
- **`cf6e8e18d`** + **`a028c0512`** + **`3d771afe7`** + **`8fdb2e64a`** + **`7ca8d936d`** + **`18610a587`** — Feishu: preserve doc block order, use resolved account in status probe, tighten mention trigger matching, buffer upload path, remove workspace dev dependency, refresh lockfile.
- **`36e27ad56`** + **`6d9d4d04e`** — Memory/QMD: add configurable search mode with query/search/vsearch support and fallback on unsupported flags.
- **`dd6047d99`** — fix(cron): prevent duplicate fires when multiple jobs trigger simultaneously.
- **`c28cbac51`** — CI: add PR size autolabel workflow.

**Line number shifts in this sync:** `qmd-manager.ts` +22 lines at 260-275 (search mode refactor + error fallback), +12 at 975 (new `isUnsupportedQmdOptionError()`), +11 at 1010 (new `buildSearchArgs()`). Old 324-329→346-352 (.md validation), old 972-978→1006-1012 (`buildCollectionFilterArgs`). `backend-config.ts` +10 (new `searchMode` field + resolver). Old 223-242→233-252 (`resolveDefaultCollections`). `cron/isolated-agent/run.ts` +3 at 124 (agentId comments). Old 310-315→303-310 (suspicious patterns, already stale from prior sync), old 321-327→316-322 (`buildSafeExternalPrompt`). `sessions/store.ts` -1 (removed JSON5 import). Old 209-211→208-210. All references updated in documentation.

**CVE status:** 5 published advisories — all pre-existing, none patched in this merge.

**Gap status: 1 closed, 3 remain open** (pipe-delimited token format, outPath validation, bootstrap/memory .md scanning — unchanged) — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
