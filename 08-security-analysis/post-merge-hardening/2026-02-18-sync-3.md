> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Feb 18 Sync 3 (21 commits)

**Merge commit:** 50fd2a99b | **Range:** 0d61388ce..50fd2a99b

### Security-Relevant Commits

| SHA | Message | Files | Security Impact |
|-----|---------|-------|-----------------|
| `81fd771cb` | fix(gateway): preserve chat.history context under hard caps | 2 prod + 1 test + 2 doc | Prevents context denial-of-service via oversized message injection. Two-stage hardening: `replaceOversizedChatHistoryMessages()` at `src/gateway/server-methods/chat.ts:223` replaces oversized messages with placeholder; `enforceChatHistoryFinalBudget()` at line 242 applies 12MB byte budget. Attackers could inject 450KB payload to clear conversation history and evade safety filters. |
| `1f850374f` | fix(gateway): harden channel health monitor recovery | 5 prod + 2 test | Prevents config bypass via undefined `enabled`/`configured` flags. New `isManagedAccount()` at `src/gateway/channel-health-monitor.ts:31` treats `undefined` as "managed" (monitoring enabled), only explicit `false` bypasses. Schema validation at `src/config/zod-schema.ts:443` enforces non-negative intervals. Prevents "zombie" channels bypassing health monitoring. |

### Non-Security Commits

| SHA | Message | Files | Reason |
|-----|---------|-------|--------|
| `50fd2a99b` | chore: Fix types in tests 13/N. | 0 prod + 15 test | Test type fixes |
| `607011638` | revert(exec): undo accidental merge of PR #18521 | 2 prod + 1 doc | Exec import order revert |
| `f6e68b917` | docs(cron): clarify webhook posting summary condition | 0 prod + 1 doc | Docs only |
| `ae82371d8` | revert(docs): undo accidental merge of #18516 | 0 prod + 2 doc | Docs revert |
| `3df8305cb` | fix(ui): gate sessions refresh on successful delete | 2 prod + 2 test | UI bug fix |
| `9c5f08244` | chore: Format files. | 15 prod + 0 test | Import formatting |
| `391796a3f` | fix(agents): restore multi-image image tool schema contract | 1 prod + 2 test | Image tool schema fix |
| `966e5560f` | revert(telegram): undo accidental merge of PR #18564 | 1 prod + 0 test | Telegram import revert |
| `0c1c34c95` | refactor(plugins): split before-agent hooks by model and prompt phases | 3 prod + 5 test | Plugin refactor |
| `a75e95be0` | fix(reply): track messaging media aliases for dedupe | 2 prod + 2 test | Media dedupe fix |
| `4aed4eedb` | test(extensions): cast fetch mocks to satisfy tsgo | 0 prod + 2 test | Test type fix |
| `f7e75d2c5` | fix(doctor): repair googlechat open dm wildcard auto-fix | 1 prod + 2 test | Doctor config fix |
| `81741c37f` | fix(gateway): remove watch-mode build/start race (#18782) | 2 prod + 2 test | Build race fix |
| `4b8f53979` | chore: Fix type errors from reverts. | 9 prod + 0 test | Type fixes |
| `262b7a157` | chore: chore: Fix types in tests 12/N. | 2 prod + 5 test | Test type fixes |
| `e02feaff8` | chore: Fix types in tests 11/N. | 0 prod + 6 test | Test type fixes |
| `058eb8576` | chore: Fix types in tests 10/N. | 2 prod + 3 test | Test type fixes |
| `95f344e43` | chore: Fix types in tests 9/N. | 2 prod + 3 test | Test type fixes |
| `5dc898395` | chore: Fix types in tests 8/N. | 3 prod + 2 test | Import reordering |

### Audit Cross-Reference

**New Hardening (not mapped to existing claims):**
- Chat history context preservation (DoS prevention)
- Channel health monitor config bypass fix

**Unaffected Claims:**
- Audit 1 Claims 1-8 (OAuth, file permissions, path traversal, webhook)
- Audit 2 Claims 1-8 (setupCommand, nodes tool, logs.tail, SSRF, RBAC, token format, shell injection, env var)
- Legitimate Gaps 1-4 (gateway env blocklist remains closed; pipe token format, outPath validation, bootstrap scanning remain open)

### Summary

This batch includes **two security-relevant commits** — both defense-in-depth hardening for gateway components:

1. **Chat history DoS prevention** — Prevents attackers from injecting oversized messages to clear conversation history and evade safety filters
2. **Channel health monitor bypass fix** — Prevents "zombie" channels that bypass health monitoring via undefined config flags

The remaining 19 commits are predominantly test type fixes (8 commits), formatting/import reordering (3 commits), reverts of accidental merges (3 commits), and non-security bug fixes (5 commits).

**Gap status: 1 closed, 3 remain open.** — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
