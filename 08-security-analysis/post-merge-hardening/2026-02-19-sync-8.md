> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Feb 19 sync 8 — 45 commits, 1 security

**Merge commit:** 47bfb765a | **Range:** 24ea1a6c2..47bfb765a

### Security-Relevant Commits

| SHA | Message | Files | Security Impact |
|-----|---------|-------|-----------------|
| `cfc5e7bd8` | fix(media): harden saveMediaSource against symlink TOCTOU | 2 prod + 1 doc | Defense-in-depth: symlink attack prevention |

### Security Details

**1. `cfc5e7bd8` — Symlink TOCTOU Protection in Media Store**

Hardens `saveMediaSource()` in `src/media/store.ts` against symlink-based Time-of-Check-Time-of-Use (TOCTOU) attacks:

- Uses `O_NOFOLLOW` flag when opening local files to prevent following symlinks (line 104-105)
- Checks for symlink-related errors (`ELOOP`, `EINVAL`, `ENOTSUP`) and rejects them (line 110-113)
- Verifies `stat.ino === lstat.ino && stat.dev === lstat.dev` to detect TOCTOU race conditions where the file is replaced between check and use (line 125-127)
- Adds explicit symlink rejection test coverage in `src/media/store.test.ts`

This prevents an attacker from:
1. Creating a symlink pointing to sensitive files
2. Having the agent read through that symlink, exfiltrating sensitive data via media handling

**Audit Cross-Reference:** This is a NEW security control not directly related to the 16 audit claims or 3 legitimate gaps. It adds defense-in-depth for media file handling.

### Non-Security Commits

| SHA | Message | Files | Reason |
|-----|---------|-------|--------|
| `47bfb765a` | ci: skip bun matrix steps on push runs | 1 prod | CI optimization |
| `745068a59` | test(agents): share overflow retry compaction fixture | 3 test | Test deduplication |
| `b41fd2074` | test(agents): share assistant error message test fixture | 2 test + 1 prod (NEW) | Test deduplication |
| `f57ba32f8` | ci: skip bun matrix lane on push | 1 prod | CI optimization |
| `434469957` | build: regenerate swift protocol models for updateAvailable | 2 prod | Build regeneration |
| `5a98a7984` | Remove triage order section from PR_WORKFLOW.md | 1 doc | Docs cleanup |
| `5e7cffc56` | test: merge duplicate plugin memory-none cases | 1 test | Test deduplication |
| `28377b150` | test: merge logger subsystem prefix drop cases | 1 test | Test deduplication |
| `34ddf0edc` | style: format gateway health state and ui render | 2 prod | Style/formatting |
| `d1cb779f5` | test(agents): dedupe embedded runner and sessions lifecycle fixtures | 2 test | Test deduplication |
| `c9b5def1b` | test(agents): dedupe openai reasoning replay fixtures | 1 test | Test deduplication |
| `50805d897` | test(agents): dedupe patch and cli credential assertions | 2 test | Test deduplication |
| `429b8783f` | test(agents): dedupe avatar and compaction fixtures | 2 test | Test deduplication |
| `586b1f6ee` | ci: drop docker metadata action to avoid API throttling | 1 prod | CI optimization |
| `2ddc13cdb` | feat(ui): add update warning banner to control dashboard | 5 prod + 3 ui | New feature |
| `13f2fa0c5` | ci: avoid bun setup API flake in node checks | 2 prod | CI hardening |
| `64546d33e` | test(cli): dedupe cron edit existing-job lookup mocks | 1 test | Test deduplication |
| `072b16b58` | ci: use git context for docker metadata extraction | 1 prod | CI optimization |
| `647a46a06` | ci: skip bun setup for windows checks | 1 prod | CI optimization |
| `65cf56d48` | test(agents): dedupe generic repeat loop fixtures | 1 test | Test deduplication |
| `e4bb6e044` | test(cron): dedupe delayed-timer job assertions | 1 test | Test deduplication |
| `cdee43333` | test(browser): dedupe explicit auth-mode auto-token checks | 1 test | Test deduplication |
| `7d12c5ea4` | test: remove duplicate extra-high think-level case | 1 test | Test deduplication |
| `3cfcb2599` | test(agents): dedupe transcript duplicate-tool fixtures | 1 test | Test deduplication |
| `c4c2060b8` | test(agents): dedupe sessions_spawn requester run setup | 1 test | Test deduplication |
| `47bbef30f` | test: merge duplicate undefined api-key persistence checks | 1 test | Test deduplication |
| `fe3bd9d65` | test: merge duplicate gateway token coercion checks | 1 test | Test deduplication |
| `148116048` | test(cli): dedupe browser state command setup | 1 test | Test deduplication |
| `a76f552b0` | test(agents): dedupe workspace memory-entry assertions | 1 test | Test deduplication |
| `53a4e5151` | test(agents): dedupe tool image fixture setup | 1 test | Test deduplication |
| `69e6da0e2` | test(auto-reply): dedupe heartbeat typing flow setup | 1 test | Test deduplication |
| `3c7c45e15` | test(gateway): dedupe config.apply request scaffolding | 1 test | Test deduplication |
| `e0c3cc498` | test(browser): dedupe auth mode no-token assertions | 1 test | Test deduplication |
| `edce5a505` | test(cron): dedupe applyJobPatch fixture setup | 1 test | Test deduplication |
| `733e38584` | test(hooks): dedupe gmail runtime path assertions | 1 test | Test deduplication |
| `d8b720cc5` | test(config): dedupe model provider fixture setup | 1 test | Test deduplication |
| `8bb1747ad` | test(gateway): dedupe assistant chat event assertions | 1 test | Test deduplication |
| `644d03796` | test(config): dedupe OPENCLAW_HOME path assertions | 1 test | Test deduplication |
| `ab924eb52` | test(infra): dedupe outbound recovery test scaffolding | 1 test | Test deduplication |
| `4e5cffe4c` | test: fix flaky run-node spawn side-effects | 1 test | Test fix |
| `9c2640a81` | docs: clarify WhatsApp group allowlist and reply mention behavior | 2 doc | Docs clarification |
| `ad4c784f2` | test: collapse duplicate gateway token-generation cases | 1 test | Test deduplication |
| `b78fa5740` | test: remove duplicate telegram de-linkify case | 1 test | Test deduplication |
| `d3dab089d` | fix: preserve reasoning stream partial contract (#20635) | 1 doc | Bug fix |

### Documentation Updates

- Updated stale reference in `explain-clawdbot/06-optimizations/resource-usage.md:145`: media store TTL constant and cleanup function line numbers (15,87-99 → 16,94-130)

**Gap status: 1 closed, 3 remain open.** — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
