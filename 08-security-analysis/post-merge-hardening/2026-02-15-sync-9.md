> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Post-Merge Hardening (Feb 15 sync 9) — 30 upstream commits

**Merge commit:** 82f038895 | **Range:** 936de46b9..82f038895

**Security relevance: LOW** — 2 security-adjacent commits out of 30. Primarily test performance optimization (`perf(test)`) and Slack/Discord `dmPolicy` alias refactoring.

### Security-Adjacent Commits

- **`615c9c3c9`** — **perf(test): avoid gateway boot for late invoke results:** Extracted `node.invoke.result` handler logic into dedicated `src/gateway/server-methods/nodes.handlers.invoke-result.ts` module (71 lines). Removed handler body from `src/gateway/server-methods/nodes.ts` (63 lines deleted), shifting all subsequent code. The `system.execApprovals` blocking check (previously at `nodes.ts:391-397`, documented in [sync 7](./2026-02-15-sync-7.md)) shifted to `nodes.ts:371-381`. Critical `nodeId` validation check preserved in the extracted handler. No behavioral change — existing Audit 2 Claim 5 defense (self-approving agent prevention) intact.

- **`b9d14855d`** — **Fix: Force dashboard command to use localhost URL ([#16434](https://github.com/openclaw/openclaw/pull/16434)):** Coerces `bind: "lan"` to `bind: "loopback"` when generating dashboard URLs in `src/commands/dashboard.ts:30`. LAN-bound URLs fail browser secure-context checks; this fix ensures dashboard always uses `127.0.0.1`. Minor defense-in-depth: reduces dashboard URL exposure surface when `gateway.bind=lan` is configured. Also adds `GatewayBindMode` to Swift protocol models in `apps/macos/` and `apps/shared/`.

### Non-Security Commits (28 of 30)

| Category | Count | SHAs | Notes |
|----------|-------|------|-------|
| perf(test) — test speed | 9 | 82f038895, 7418400c4, 387fb4074, 857db619e, ad5e7b968, 3f5351529, 5e496a151, e6f75e526, 9365cd424 | Mock subprocesses, skip heavy boot paths, speed up cleanup |
| refactor(test) — shared mocks | 3 | af784b9a8, 9c5404d95, fe5cc8f3b | CLI e2e mocks, telegram heartbeat, discord handler setup |
| test — isolation/harness | 4 | 91c30f46f, 31295c834, 519ffd59d, 7db6eade0 | Browser auth env isolation, web monitor harness, imessage test |
| test — deflake | 1 | 82576aa68 | Cron read-ops nonblocking timing |
| config — dmPolicy aliases | 4 | 47b6cde8c, ffcf37f8c, bf76452b4, 52ad64f8f | Add `dmPolicy`/`allowFrom` top-level aliases for Slack/Discord; legacy `dm.policy` migration in doctor command |
| test — dmPolicy coverage | 1 | 9d0a1e32b | Monitor alias coverage for Slack/Discord |
| chore — lint/deps | 2 | dff3f8c27, 185792b6c | Lint fix after handler split; dependency update (minor bumps) |
| CLI fix | 1 | ee2970336 | Remove grouped placeholders before register in command-registry |
| docs | 3 | 2a1ed0ed4, 9abf86f7e, 21f0e3fa0 | WhatsApp dmPolicy docs, changelog, Slack/Discord docs |

### Commit Chains

- **Gateway handler split:** `615c9c3c9` (extract handler) + `dff3f8c27` (lint fix) — shared: `src/gateway/server-methods/nodes.ts`
- **Doctor legacy config:** `ffcf37f8c` (no-op conflict notes) + `bf76452b4` (migration logic) — shared: `src/commands/doctor-legacy-config.ts`
- **dmPolicy alias chain:** `47b6cde8c` (refactor 13 files) → `ffcf37f8c` + `bf76452b4` (doctor fixes) → `52ad64f8f` + `9d0a1e32b` (test coverage) → `9abf86f7e` + `21f0e3fa0` (docs)

### Line Number Shifts

| File | Old | New | Symbol | Tag |
|------|-----|-----|--------|-----|
| `src/gateway/server-methods/nodes.ts` | 391-397 | 371-381 | `system.execApprovals` blocking check | VERIFIED |

### Audit Cross-Reference

- **Audit 2 Claim 5** (self-approving agent): No behavioral change. `execApprovals` blocking check preserved at new line range (`371-381`). Handler extraction (`615c9c3c9`) moves `node.invoke.result` processing to dedicated module but all validation logic intact.
- No other audit claims or legitimate gaps affected.

### New Official Advisories (4)

| ID | Severity | Summary | Patched |
|----|----------|---------|---------|
| [GHSA-qrq5-wjgg-rvqw](https://github.com/openclaw/openclaw/security/advisories/GHSA-qrq5-wjgg-rvqw) | CRITICAL | Path Traversal in Plugin Installation | >= 2026.2.1 |
| [GHSA-rv39-79c4-7459](https://github.com/openclaw/openclaw/security/advisories/GHSA-rv39-79c4-7459) | HIGH | Gateway Device Identity Skip (auth.token presence vs validation) | >= 2026.2.2 |
| [GHSA-qj77-c3c8-9c3q](https://github.com/openclaw/openclaw/security/advisories/GHSA-qj77-c3c8-9c3q) | HIGH | Windows cmd.exe Exec Allowlist Bypass | >= 2026.2.2 |
| [GHSA-mqpw-46fh-299h](https://github.com/openclaw/openclaw/security/advisories/GHSA-mqpw-46fh-299h) | HIGH | operator.write Exec Approval Bypass via `/approve` Command | >= 2026.2.2 |

**Gap status: 1 closed, 3 remain open** — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
