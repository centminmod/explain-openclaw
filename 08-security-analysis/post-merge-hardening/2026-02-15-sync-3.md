> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Feb 15 sync 3 (30 commits)

**Merge commit:** 06bc9f368 | **Range:** bb9cea14c..06bc9f368

### Security-Relevant Commits

1. **`3967ece62`** — **fix(security): OC-25 — Validate OAuth state parameter to prevent CSRF attacks ([#16058](https://github.com/openclaw/openclaw/pull/16058)):** Added explicit `state !== expectedState` validation in `src/agents/chutes-oauth.ts`. Previously, the catch block fabricated matching state values, allowing an attacker to trick victims into pasting attacker-controlled authorization codes. Now always returns error for non-URL input. Files: `src/agents/chutes-oauth.ts`, `src/agents/chutes-oauth.test.ts`, `src/commands/chutes-oauth.ts`. **Addresses Audit 1 Claim 2** (Missing CSRF in OAuth state).

2. **`b566b09f8`** — **fix(security): block cross-origin mutations on loopback browser routes:** New CSRF mutation guard middleware (`src/browser/csrf.ts`) blocks POST/PUT/PATCH/DELETE requests from non-loopback origins by checking Origin, Referer, and Sec-Fetch-Site headers. Applied to `src/browser/bridge-server.ts` and `src/browser/server.ts`. Files: `src/browser/csrf.ts` (new), `src/browser/csrf.test.ts` (new), `src/browser/bridge-server.ts`, `src/browser/server.ts`. General browser security hardening.

3. **`a6fbd0393`** — **fix(browser): annotate csrf middleware type:** Type annotation for `browserMutationGuardMiddleware()` — chain commit for `b566b09f8`. Files: `src/browser/csrf.ts`.

4. **`31791233d`** — **fix(security): reject oversized base64 before decode:** New `estimateBase64DecodedBytes()` function (`src/media/base64.ts`) validates base64 size before `Buffer.from()` to prevent memory exhaustion. Uses character-by-character iteration to avoid allocating intermediate strings on multi-MB inputs. Files: `src/media/base64.ts` (new), `src/gateway/chat-attachments.ts`, `src/media/input-files.ts`, `src/gateway/chat-attachments.test.ts`, `src/media/input-files.fetch-guard.test.ts`. DoS prevention hardening.

5. **`d3ee5deb8`** — **fix(archive): enforce extraction resource limits:** Comprehensive resource limits for ZIP/TAR extraction in `src/infra/archive.ts`: `maxArchiveBytes` (256 MB), `maxEntries` (50,000), `maxExtractedBytes` (512 MB), `maxEntryBytes` (256 MB). Budget tracking via `createExtractBudgetTransform()`. Files: `src/infra/archive.ts`, `src/infra/archive.test.ts`, CHANGELOG.md. **Strengthens defenses for Audit 2 Claim 2** (arbitrary write via outPath).

6. **`4c7838e3c`** — **refactor(archive): centralize limits and budgets:** Extracted hard-coded archive limits into named constants (`DEFAULT_MAX_ARCHIVE_BYTES_ZIP`, `DEFAULT_MAX_ENTRIES`, etc.) in `src/infra/archive.ts`. Foundation commit for `d3ee5deb8`. Files: `src/infra/archive.ts`.

7. **`5f4b29145`** — **test(archive): cover archive size and absolute tar paths:** Added test coverage for archives exceeding `maxArchiveBytes` and TAR entries with absolute paths (path traversal protection). Files: `src/infra/archive.test.ts`.

8. **`e3b432e48`** — **fix(telegram): require sender ids for allowlist auth:** Deprecated `users/<email>` format in Telegram allowlists. Now requires numeric sender IDs or `users/<id>` format. Added `isNumericTelegramUserId()` validation in `src/security/audit-channel.ts`. Files: `src/telegram/bot-access.ts`, `src/security/audit-channel.ts`, `src/security/audit.test.ts`, and 7 more. Access control hardening.

9. **`c8424bf29`** — **fix(googlechat): deprecate users/\<email\> allowlists ([#16243](https://github.com/openclaw/openclaw/pull/16243)):** Similar to `e3b432e48` — deprecated `users/<email>` format in Google Chat allowlists. Requires numeric user IDs. Files: `extensions/googlechat/src/monitor.ts`, `extensions/googlechat/src/monitor.test.ts`, `extensions/googlechat/src/onboarding.ts`, CHANGELOG.md, `docs/channels/googlechat.md`.

10. **`1f1fc095a`** — **refactor(sandbox): auto-recreate browser container on config changes ([#16254](https://github.com/openclaw/openclaw/pull/16254)):** Added config hash tracking via `computeSandboxBrowserConfigHash()` in `src/agents/sandbox/config-hash.ts`. Detects when sandbox browser configuration changes and logs a hint to recreate. Files: `src/agents/sandbox/browser.ts`, `src/agents/sandbox/config-hash.ts`, `src/agents/sandbox/config.ts`, `src/agents/sandbox/docker.ts`, `src/agents/sandbox/registry.ts`.

11. **`cb9a5e1cb`** — **feat(sandbox): separate bind mounts for browser containers ([#16230](https://github.com/openclaw/openclaw/pull/16230)):** New `sandbox.browser.binds` config allows independent bind mount configuration for browser containers. Previously browsers inherited `docker.binds`. Files: `src/agents/sandbox/browser.ts`, `src/agents/sandbox/config.ts`, `src/agents/sandbox/types.ts`, `src/config/config.sandbox-docker.test.ts`, `src/config/types.sandbox.ts`, `src/config/zod-schema.agent-runtime.ts`, CHANGELOG.md, `docs/gateway/configuration-reference.md`, `docs/gateway/sandboxing.md`. Sandbox isolation improvement.

### Non-Security Commits (19)

| SHA | Message | Files |
|-----|---------|-------|
| 06bc9f368 | refactor(nodes): share node id matcher | 4 |
| 81361755b | refactor(reactions): share reaction level resolver | 4 |
| b769b65b4 | refactor(browser): share proxy file helpers | 3 |
| d71f6afb7 | refactor(line): centralize action helpers | 3 |
| 25ecd4216 | refactor(shared): dedupe config path eval | 3 |
| b3882ecce | refactor(config): share include scan helper | 3 |
| 7fc102674 | refactor(gateway): share agent prompt builder | 4 |
| e707a7bd3 | refactor(memory): reuse runWithConcurrency | 2 |
| 60a7625f2 | refactor(agents): share glob matcher | 4 |
| fdc3a6a80 | build(tsconfig): map plugin-sdk account-id | 1 |
| 50a6e0e69 | fix: strip leading empty lines in sanitizeUserFacingText | 3 |
| aa1dbd34a | docs: fix typo p-coding-agent -> pi-coding-agent | 2 |
| 3881af5b3 | fix: strip leading whitespace from sanitizeUserFacingText output | 3 |
| 09e1cbc35 | fix(cron): pass agent identity through delivery path | 8 |
| 497b060e4 | refactor: simplify manifest registry duplicate detection | 1 |
| 4f043991e | fix: suppress false duplicate plugin warnings | 3 |
| abf6b4997 | test(archive): accept drive-path absolute tar errors | 1 |
| b87b16e2b | docs(changelog): note browser CSRF hardening | 1 |
| 302dafbe1 | Docs: move submission guidance to GitHub templates | 11 |

### Audit Cross-Reference

| Audit Claim | Status |
|-------------|--------|
| Audit 1 Claim 2 (Missing CSRF in OAuth state) | **Directly addressed** by `3967ece62` (OC-25 OAuth state validation) |
| Audit 2 Claim 2 (Arbitrary write via outPath) | **Strengthened** by `d3ee5deb8` + `4c7838e3c` + `5f4b29145` (archive extraction limits + path traversal tests) |

### Line Number Updates

| File | Old | New | Context |
|------|-----|-----|---------|
| `src/agents/sandbox/docker.ts` | 238-339 | 256-357 | All refs shifted +18 due to new `user` and `env` params |
| `src/agents/sandbox/config.ts` | 39-149 | 54-168 | All refs shifted +19 due to new `resolveSandboxBrowserDockerConfig()` and `resolveSandboxBrowserConfig()` functions |
| `src/security/audit-extra.async.ts` | 770-933 | 675-850 | Include scan helper extracted to `src/config/includes-scan.ts` |
| `src/cron/isolated-agent/run.ts` | 327-346 | 327-356 | Delivery path changes expanded the hook wrapping section |
| `src/infra/archive.ts` | 86-220 | 119-414 | Centralized limits/budgets and new extraction functions added |

**Gap status: 1 closed, 3 remain open** — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
