> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Feb 18 Sync 1 (21 commits)

**Merge commit:** c49234cbf | **Range:** f86ec4f77..c49234cbf

### Security-Relevant Commits

| SHA | Message | Files | Notes |
|-----|---------|-------|-------|
| `3518554e2` | fix(heartbeat): bound responsePrefix strip for ack detection | 1 prod + 1 test + 1 doc | Heartbeat acknowledgment validation |
| `afa553325` | fix(mattermost): harden react remove flag parsing | 1 prod + 2 test + 0 doc | Mattermost input validation |
| `d6226355e` | fix(slack): validate interaction payloads and handle malformed actions | 1 prod + 1 test + 1 doc | Slack payload validation |
| `bbb5fbc71` | fix(scripts): harden Windows UI spawn behavior | 1 prod + 1 test + 1 doc | Windows process spawning |
| `3fff266d5` | fix(session-memory): harden reset transcript recovery | 1 prod + 1 test + 1 doc | Session transcript handling |
| `67250f059` | fix(slack): scope attachment extraction to forwarded shares | 1 prod + 2 test + 1 doc | Slack attachment security |
| `fb996031b` | fix(process): harden graceful kill-tree cancellation semantics | 2 prod + 2 test + 0 doc | Process cleanup hardening (relates to GHSA-jfv4-h8mc-jcp8) |
| `2992639f8` | Revert "feat: add Linq channel — real iMessage via API, no Mac required" | 17 files | Removes entire Linq integration (external API dependencies, token handling, webhook processing) |

### Non-Security Commits

| SHA | Message | Files | Reason |
|-----|---------|-------|--------|
| `c49234cbf` | chore: chore: Fix types in tests 4/N. | 6 test | Test type fixes |
| `1406b2846` | chore: Fix types in tests 3/N. | 6 test | Test type fixes |
| `c219c85df` | docs(changelog): record PR 18608 fixups | 1 doc | Changelog only |
| `f818de7be` | docs(changelog): note slack forwarded attachment hotfix | 1 doc | Changelog only |
| `3793424f5` | docs(changelog): note process kill-tree hotfix | 1 doc | Changelog only |
| `c0c367fde` | docs: clarify discord proxy scope for startup REST calls | 1 doc | Documentation only |
| `742e6543c` | fix(ui): preserve locale bootstrap and trusted-proxy overview behavior | 8 prod | UI/proxy fixes (non-security) |
| `7b172d61c` | Revert "fix: respect OPENCLAW_HOME for isolated gateway instances" | 2 prod | Config revert (non-security) |
| `014a46d3f` | Revert "fix: session-memory hook finds previous session file after /new/reset" | 1 prod | Revert (non-security) |
| `accb67349` | revert(telegram): undo accidental merge of PR #18601 | 2 files | Revert of accidental merge |
| `a1538ea63` | Revert "fix: flatten remaining anyOf/oneOf in Gemini schema cleaning" | 4 prod | Schema revert (non-security) |
| `a36782e34` | Revert "feat(linq): add interactive onboarding adapter" | 3 prod | Part of Linq removal |
| `0d1eceb9c` | Revert "Onboarding: fix webchat URL loopback and canonical session" | 4 prod | Onboarding revert (non-security) |

### Details

1. **`3518554e2`** — **Heartbeat response prefix boundary check:** Adds `stripLeadingHeartbeatResponsePrefix()` function at `src/infra/heartbeat-runner.ts:433-447` that requires a word boundary after the configured prefix. Prevents short prefixes like "Hi" from stripping the beginning of normal words like "History" during heartbeat acknowledgment detection.

2. **`afa553325`** — **Mattermost react flag parsing hardening:** Hardens parsing of react remove flags in `extensions/mattermost/src/channel.ts`. Validates input to prevent malformed data from causing unexpected behavior.

3. **`d6226355e`** — **Slack interaction payload validation:** Adds validation for Slack interaction payloads and handles malformed actions in `src/slack/monitor/events/interactions.ts`. Prevents malformed interaction payloads from triggering unexpected agent behavior.

4. **`bbb5fbc71`** — **Windows UI spawn hardening:** Hardens Windows UI spawn behavior in `scripts/ui.js`. Improves process spawning safety on Windows platforms.

5. **`3fff266d5`** — **Session-memory reset transcript recovery:** Adds `stripResetSuffix()` and `findPreviousSessionFile()` functions to `src/hooks/bundled/session-memory/handler.ts:110-165`. Improves recovery from reset transcript states by searching for previous session files.

6. **`67250f059`** — **Slack attachment scope limiting:** Scopes Slack attachment extraction to forwarded shares only in `src/slack/monitor/media.ts`. Prevents unauthorized access to non-forwarded attachments.

7. **`fb996031b`** — **Kill-tree cancellation semantics:** Adds `normalizeGraceMs()` at `src/process/kill-tree.ts:28-35` (bounds grace period to 0-60000ms) and `isProcessAlive()` at `:36-43` (validates PID before kill). Relates to GHSA-jfv4-h8mc-jcp8 (Unvalidated PID Kill via SIGKILL).

8. **`2992639f8`** — **Linq channel removal:** Reverts the entire Linq iMessage channel implementation, removing:
   - External API integration with `api.linqapp.com`
   - Token handling from config/env/file
   - Webhook processing with HMAC-SHA256 verification
   - Configuration schema with sensitive fields (`apiToken`, `webhookSecret`)
   - Channel registration and runtime integration

   This removal eliminates a significant external attack surface including third-party API dependencies and credential handling for the Linq Blue V3 API.

### Audit Cross-Reference

**Affected Claims:** None directly. The hardening commits reinforce existing controls but do not change audit verdicts.

- Claim 6 (Process Isolation): Kill-tree hardening (`fb996031b`) strengthens process cleanup but doesn't change the isolation model
- Claim 7 (Input Validation): Slack/Mattermost validation commits reinforce existing input validation patterns
- Claim 3 (External APIs): Linq removal (`2992639f8`) reduces external API attack surface

**Unaffected Claims:** Claims 1, 2, 4, 5, 8-16 remain unchanged. The three legitimate gaps (pipe-delimited tokens, outPath validation, bootstrap `.md` scanning) are unaffected.

**Gap status:** No changes — 1 closed, 3 remain open. — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
