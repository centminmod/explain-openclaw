> [Back to Post-Merge Hardening Index](../post-merge-hardening.md) | [Legitimate Gaps](../post-merge-hardening.md#legitimate-gaps-status)

## Post-Merge Hardening (Feb 13 sync 2, 17 commits)

Merge commit `7cca0e0da` — 17 upstream commits (`bca0652de..afbce7357`). Mostly reliability, portability, and UX fixes; one new z.ai feature; no direct security fixes.

**MEDIUM — Defensive input validation (1):**

1. **`d8d810971`** (PR [#14903](https://github.com/openclaw/openclaw/pull/14903)) — **fix(agents): guard against undefined path in context file entries:** Adds `validContextFiles` filter in `src/agents/system-prompt.ts:553-555` that rejects entries where `file.path` is not a non-empty string before injecting into the system prompt. Prevents potential issues from malformed context file entries reaching SOUL.md detection or prompt construction. Defense-in-depth for bootstrap context injection path.

**LOW — Portability & reliability (4):**

2. **`afbce7357`** (PR [#14985](https://github.com/openclaw/openclaw/pull/14985)) — **fix: use os.tmpdir fallback paths for temp files:** Replaces hardcoded `/tmp/openclaw` with `os.tmpdir()` in browser downloads (`src/browser/pw-tools-core.downloads.ts:24`), debug trace (`src/browser/routes/agent.debug.ts:135`), and log directory resolution (`src/logging/logger.ts:14-21`). Logger retains `/tmp/openclaw` on macOS for Debug UI compatibility but falls back to `os.tmpdir()` on platforms where `/tmp` is read-only (Termux/Android). No security posture change.

3. **`5147656d6`** (PR [#14901](https://github.com/openclaw/openclaw/pull/14901)) — **fix: prevent heartbeat scheduler death when runOnce throws:** Wraps `runOnce()` in try/catch in `src/infra/heartbeat-runner.ts:905-916` so heartbeat scheduling continues after unhandled errors (e.g. session compaction crashes). Also reschedules timer on `requests-in-flight` skip (`src/infra/heartbeat-runner.ts:918-919`). Prevents silent heartbeat death that could delay security-relevant heartbeat checks.

4. **`8d5094e1f`** (PR [#14919](https://github.com/openclaw/openclaw/pull/14919)) — **fix: resolve symlinked argv1 for Control UI asset detection:** `candidateDirsFromArgv1()` in `src/infra/openclaw-root.ts:65-73` now resolves symlinks to find the real package root when installed via version managers (nvm, fnm, Homebrew). Fixes "Open log" / Debug UI asset lookups.

5. **`5e7842a41`** (PR [#14786](https://github.com/openclaw/openclaw/pull/14786)) — **feat(zai): auto-detect endpoint + default glm-5:** New `src/commands/zai-endpoint-detect.ts` (148 lines) auto-detects z.ai endpoint during onboarding. Credential handling follows existing provider auth patterns in `src/commands/auth-choice.apply.api-providers.ts`.

**Line number shifts in this sync:** `system-prompt.ts` +3 lines at 553 (validContextFiles filter): old 552-569→552-572 (SOUL.md section), old 572-587→575-590 (silent replies), old 164-609→164-612 (buildAgentSystemPrompt range), old 648→651 total lines. `logger.ts` +10 lines at 11 (resolveDefaultLogDir function + os import): old 102-109→112-119 (buildLogger), old 18→28 (MAX_LOG_AGE_MS), old 227-251→237-261 (pruneOldRollingLogs). All references updated in documentation.

**CVE status:** 5 published advisories — all pre-existing, none patched in this merge.

**Gap status: 1 closed, 3 remain open** (pipe-delimited token format, outPath validation — Gap #3 partially mitigated, bootstrap/memory .md scanning — Gap #4 unchanged) — see [Legitimate Gaps Status](../post-merge-hardening.md#legitimate-gaps-status).
